WITH LEGAL AS (
SELECT OVER,LAG(LAST_BALL,1,0) OVER (ORDER BY OVER)+1 FIRST_BALL ,LAST_BALL,RUNS
        FROM (
SELECT OVER,MIN(BALL_NO) FIRST_BALL,MAX(BALL_NO) LAST_BALL,SUM (RUNS) RUNS
    FROM (
SELECT BALL_NO,RUNS,DELIVERY_TYPE, 
    FLOOR((ROW_NUMBER () OVER (ORDER BY BALL_NO)-1)/6+1) OVER
    FROM cricket_runs
    WHERE DELIVERY_TYPE='legal'
    ORDER BY BALL_NO)
    GROUP BY OVER
    ORDER BY 1)),
    
EXTRA AS 
    (SELECT BALL_NO,RUNS+1 RUNS
    FROM cricket_runs
    WHERE DELIVERY_TYPE<>'legal')

    SELECT OVER,RUNS+EXTRA_RUNS TOTAL_RUN_PER_OVER
    FROM (
    SELECT L.OVER ,L.RUNS,NVL(SUM(E.RUNS),0) EXTRA_RUNS
    FROM 
    LEGAL L 
    LEFT JOIN EXTRA E
    ON E.BALL_NO BETWEEN L.FIRST_BALL AND L.LAST_BALL
    GROUP BY L.OVER ,L.RUNS
    ORDER BY L.OVER)
    ;
